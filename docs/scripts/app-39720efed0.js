"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=window.smi2=window.smi2||{};e.app={name:"SMI2",version:window.clickhouseGuiVersion||""},angular.module(e.app.name,["ngAnimate","ui.router","LocalStorageModule","angularScreenfull","ui.ace","ui.grid","ui.grid.autoResize","angularResizable","ngSanitize","ngMaterial","funMetisMenu","ngScrollbars","ngCsv","pascalprecht.translate"])}(),angular.module("SMI2").run(["$templateCache",function(e){e.put("app/base/404.html",'<div class="p++"><h2 class="mt0">404 {{\'не найдено\' | translate}}</h2><md-button class="ml0 md-raised md-primary" ui-sref="dashboard"><i class="mdi mdi-arrow-left"></i> {{ \'Назад\' | translate }}</md-button></div>'),e.put("app/base/base.html",'<div class="wrapper"><header ui-view="header" class="header-view"></header><div class="content"><div ui-view="sidebar" ng-class="{\'show\': showSidebar}" class="sidebar-view" resizable="" r-directions="[\'right\']" r-width="200" r-flex="true"></div><div class="main-content"><div ui-view="main" style="height: 100%"></div><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="tableSiedenav"><md-content ng-if="currentTable" layout-padding=""><md-button class="md-icon-button right-button" ui-sref="table({tableName:currentTable, dbName:currentDatabase})"><i class="mdi mdi-arrow-expand-all"></i><md-tooltip md-direction="left">{{\'Открыть таблицу\' | translate}}</md-tooltip></md-button><div class="h100" ng-include="\'app/table/table-container.html\'" ng-controller="TableContainerController" ng-init="initContainer()"></div></md-content></md-sidenav></div></div></div>'),e.put("app/base/breadcrumbs.html",'<ol ng-if="$root.breadcrumbs" class="breadcrumb p+"><li class="home-item"><a ui-sref="dashboard" lx-ripple="lx-ripple" class="btn btn--xs btn--white btn--fab"><i class="mdi mdi-home"></i></a></li><li ng-repeat="nav in $root.breadcrumbs" class="breadcrumb-item"><i class="icon tc-white icon--xs mdi mdi-chevron-right"></i> <a ng-if="!$last" ui-sref="{{nav.link}}(nav.params)" class="btn btn--xs btn--white btn--raised">{{nav.text}}</a> <span ng-if="$last" class="tc-white">{{nav.text}}</span></li></ol>'),e.put("app/base/header.html",'<div class="header"><md-card class="m0 pl0"><div><div class="pull-left" style="width: 580px"><img src="assets/images/logo.png" class="logo mr"> <a style="text-decoration: underline" target="_blank" href="https://tabix.io" class="tc-white">This project depreciation, see Tabix.IO</a></div><div class="pull-right"><md-menu md-position-mode="target-right target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark"></i><md-tooltip>{{\'Тема\' | translate}}</md-tooltip></md-button><md-menu-content><md-menu-item ng-repeat="theme in themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu><md-button aria-label="menu" class="md-icon-button" ui-sref="sql"><i class="mdi mdi-24px mdi-console"></i><md-tooltip>SQL</md-tooltip></md-button><md-button class="md-icon-button" aria-label="{{\'Выход\' | translate}}" ng-click="logout()"><i class="mdi mdi-24px mdi-lock"></i><md-tooltip>{{\'Выход\' | translate}}</md-tooltip></md-button><span class="header-user-name hide-sm p+">{{user}}</span></div></div></md-card></div>'),e.put("app/base/sidebar.html",'<div class="sidebar" ng-app="sidebar" ng-scrollbars="" ng-scrollbars-config="vars.scrollConfig"><fun-metis-menu ng-if="vars.loaded" fun-metis-config="vars.metis.config" fun-metis-events="vars.metis.events" class="metismenu"><nav><ul><li ng-repeat="database in vars.databases" ng-class="currentDatabase==database.name?\'active\':\'\'"><a><md-button class="text-left no-txt-transform w100" ng-click="clickAndSelect(database, $event)"><i class="mdi mdi-database"></i>{{database.name}}</md-button></a><ul class="sub-menu" ng-if="database.tables.length"><li ng-repeat="table in database.tables"><md-button class="text-left no-txt-transform" ng-click="openTable(table)"><i class="mdi mdi-table"></i>{{table.name}}</md-button></li></ul></li></ul></nav></fun-metis-menu><div ng-if="!vars.loaded">no connect</div></div>'),e.put("app/login/login.html",'<div class="wrapper"><div class="header header-view"><md-card class="m0 pl0"><div><div class="mr pull-left"><img src="assets/images/logo.png" class="logo"></div><div class="pull-left"><a ui-sref="dashboard" class="tc-white">Clickhouse</a></div><div class="pull-right"><md-menu md-position-mode="target-right target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark"></i></md-button><md-menu-content><md-menu-item ng-repeat="theme in vars.themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu></div></div></md-card></div><div class="content"><div class="sidebar-view login"><md-card class="m0 h100" style="width: 180px"><div ng-repeat="base in vars.bases"><md-button class="menu-button" ng-click="vars.db = base"><span class="menu-button__title">{{base.name}}</span> <span class="menu-button__subtitle">{{base.host}}</span></md-button></div></md-card></div><div class="main-content login"><div class="main-view"><div class="login-view"><md-card md-theme="{{ showDarkTheme ? \'dark-grey\' : \'default\' }}" md-theme-watch=""><form class="p++" name="loginForm"><div><md-input-container><label>{{\'Название\' | translate}}</label> <input ng-model="vars.db.name" required="" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Хост:порт\' | translate}}</label> <input ng-model="vars.db.host" required="" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Логин\' | translate}}</label> <input ng-model="vars.db.login" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Пароль\' | translate}}</label> <input type="password" ng-model="vars.db.password" ng-click="onKeypress($event)" ng-disabled="vars.loading"></md-input-container></div><div layout="row"><div flex=""><md-button class="md-primary md-raised m0 width-100" ng-disabled="loginForm.$invalid || vars.loading" ng-click="login()">{{\'Войти\' | translate}}</md-button></div><div flex="" ng-if="vars.db.id" class="pl"><md-button class="md-raised md-warn m0 width-100" ng-disabled="vars.loading" ng-click="remove()">{{\'Удалить\' | translate}}</md-button></div></div></form></md-card></div></div><div class="footer"><md-card class="m0 p"><div><a href="https://github.com/smi2/clickhouse-frontend" target="_blank" class="pull-right"><i class="mdi mdi-github-circle mdi-24px"></i></a><p class="copyright text-center" style="line-height: 24px"><a href="https://github.com/smi2" target="_blank" class="tc-white">{{\'СМИ2\' | translate}}</a> &copy; {{::vars.year}}, {{\'все права защищены\' | translate}}. {{\'Сборка\' | translate}} {{::vars.version}}</p></div></md-card></div></div></div></div>'),e.put("app/sql/sql.html",'<div style="position: absolute; top: 4px; right: 4px; z-index: 2"><md-button aria-label="menu" class="md-icon-button" ng-click="toggleSidenav(\'right\')"><i class="mdi mdi-settings"></i><md-tooltip>{{\'Настройки редактора\' | translate}}</md-tooltip></md-button></div><div ngsf-fullscreen="fullscreenCtrl" class="fullscreen" ng-class="vars.uiTheme.name"><md-tabs md-dynamic-height="" md-border-bottom="" md-selected="vars.selectedTab" class="sql-tabs"><md-tab ng-repeat="tab in vars.tabs" ng-click="vars.currentTab = tab"><md-tab-label>{{tab.name + (tab.changed ? \' *\' : \'\')}} <i class="mdi mdi-pencil ml+" ng-click="changeTabName(tab, $event)" style="cursor: pointer"></i> <i class="mdi mdi-close" ng-click="removeTab(tab, $event)" style="cursor: pointer"></i></md-tab-label><md-tab-body><div style="display: table; width: 100%;"><div style="min-height: 300px; position: relative; display: table-cell;"><div resizable="" r-directions="[\'bottom\']" r-height="300" style="min-height: 300px"><div ng-model="tab.sql" ui-ace="{ useWrapMode : true, mode: \'clickhouse\', onLoad: aceLoaded, advanced: { enableBasicAutocompletion: true } }" style="min-height: 300px; width: 100%; height: 100%;"></div></div><md-button class="md-raised1 md-primary" ng-disabled="tab.loading" ng-click="execute(\'all\', tab)">{{tab.buttonTitle}}</md-button><div style="display: inline-block"><md-progress-circular md-diameter="16px" ng-if="tab.loading"></md-progress-circular></div></div><div style="width: 40px; display: table-cell; vertical-align: top;"><md-button class="md-icon-button" ng-click="fullscreenCtrl.toggleFullscreen()" aria-label="fullscreen"><i class="mdi mdi-fullscreen"></i><md-tooltip>{{\'На весь экран\' | translate}}</md-tooltip></md-button><md-button class="md-icon-button" ng-click="save(tab, $event)" show-if-fullscreen="false" aria-label="save"><i class="mdi mdi-content-save"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button><md-menu md-position-mode="target-right target" ng-if="vars.sqlHistory.length" show-if-fullscreen="false"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-history"></i></md-button><md-menu-content width="4"><md-menu-item ng-repeat="item in vars.sqlHistory track by $index" ng-click="load(item)"><md-button>{{item.name}}<md-tooltip>{{\'История зарпросов\' | translate}}</md-tooltip><div class="pull-right"><i class="mdi mdi-close ml+" ng-click="removeHistory(item, $event)"></i></div></md-button></md-menu-item></md-menu-content></md-menu><md-menu md-position-mode="target-right target" show-if-fullscreen="false"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-code-braces"></i><md-tooltip>{{\'Словари\' | translate}}</md-tooltip></md-button><md-menu-content><md-menu-item ng-repeat="dictionary in vars.dictionaries"><md-button ng-click="addDictionariesWord(dictionary.dic)">{{dictionary.title}}</md-button></md-menu-item></md-menu-content></md-menu><md-button class="md-icon-button" ng-click="toggleSidenav(\'log\')" show-if-fullscreen="false" aria-label="log"><i class="mdi mdi-view-headline"></i><md-tooltip>{{\'Лог запросов\' | translate}}</md-tooltip></md-button></div></div><md-tabs md-dynamic-height="" md-border-bottom="" ng-if="tab.results.length" md-selected="tab.selectedResultTab"><md-tab ng-repeat="result in tab.results"><md-tab-label>{{::result.time}} <i class="mdi mdi-18px ml+" ng-class="result.pinned ? \'mdi-pin\' : \'mdi-pin-off\'" ng-click="result.pinned = !result.pinned; $event.stopPropagation()"></i> <i class="mdi mdi-close" ng-click="removeResult(tab, result, $event)"></i></md-tab-label><md-tab-body><div ng-repeat="item in result.data"><md-card class="m0"><div><div class="pull-left" ng-if="item.statistics"><md-button aria-label="menu" class="md-icon-button" ng-click="addDictionariesWord(item.createtable)" ng-if="item.createtable"><i class="mdi mdi-table-large"></i></md-button><md-menu md-position-mode="target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-file-excel"></i></md-button><md-menu-content><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings=\'"\' filename="{{tab.name}}-{{result.time}}.csv" csv-header="getExportHeaders(item.meta)">{{\'CSV с заголовком\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings=\'"\' filename="{{tab.name}}-{{result.time}}.csv">{{\'CSV без заголовка\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings="" filename="{{tab.name}}-{{result.time}}.txt" field-separator="\\t" csv-header="getExportHeaders(item.meta)">{{\'Табулированный текст с заголовками\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings="" filename="{{tab.name}}-{{result.time}}.txt" field-separator="\\t" csv-header="getExportHeaders(item.meta)">{{\'Табулированный текст без заголовков\' | translate}}</md-button></md-menu-item></md-menu-content></md-menu></div><div style="white-space: nowrap; line-height: 40px" class="md-card pull-right mr" ng-if="item.statistics">{{\'время\' | translate}}: <b>{{item.statistics.elapsed | number:3}}</b>, {{\'строк прочитано\' | translate}}: <b>{{item.statistics.rows_read | number}}</b>, {{\'прочитано\' | translate}}: <b>{{item.statistics.bytes_read | filesize}}</b></div></div></md-card><div><span ng-if="item.result === null">{{\'нет данных\' | translate}}</span><div ng-if="item.result !== null" ng-bind-html="item.result" style="overflow-x: auto; overflow-y: auto; width: 100%; height: 400px"></div></div></div></md-tab-body></md-tab></md-tabs></md-tab-body></md-tab><md-tab ng-click="addTab()"><md-tab-label><i class="mdi mdi-plus-circle"></i></md-tab-label></md-tab></md-tabs></div><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="right"><div class="p+"><h4 class="mt0 mb+++">{{\'Настройки редактора\' | translate}}</h4><md-input-container class="width-100"><label for="inp1">{{\'Размер шрифта\' | translate}}</label> <input type="text" id="inp1" ng-model="vars.fontSize"></md-input-container><md-input-container class="width-100"><label for="inp2">{{\'Максимум строк\' | translate}}</label> <input type="text" id="inp2" ng-model="vars.limitRows"></md-input-container><md-input-container class="width-100 mt mb++"><label>{{\'Формат результатов\' | translate}}</label><md-select ng-model="vars.format"><md-option ng-repeat="format in vars.formats" ng-value="format" ng-click="vars.format = format">{{format.name}}</md-option></md-select></md-input-container><md-input-container class="width-100 mb++"><label>{{\'Тема редактора\' | translate}}</label><md-select ng-model="vars.theme"><md-option ng-repeat="theme in vars.themes" ng-value="theme" ng-click="setTheme(theme)">{{theme}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt mb+"><label>{{\'Тема интерфейса\' | translate}}</label><md-select ng-model="vars.uiTheme"><md-option ng-repeat="theme in vars.uiThemes" ng-value="theme" ng-click="setUiTheme(theme)">{{theme.title}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-model="vars.saveTabs" aria-label="saveTabs">{{\'Сохранять сессию\' | translate}}</md-checkbox></md-input-container><md-button ng-click="toggleSidenav(\'right\')" class="md-primary ml0 mt+++" style="line-height: inherit;">{{\'Закрыть\' | translate}}</md-button></div></md-sidenav><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="log"><div class="p+"><h4 class="mt0"><md-button class="md-icon-button pull-right" ng-click="toggleSidenav(\'log\')" aria-label="close" style="margin-top: -10px; margin-right: -10px"><i class="mdi mdi-close"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button>{{\'Лог запросов\' | translate}}</h4></div><div ng-repeat="sql in vars.sqlLog" md-ink-ripple="" style="position: relative; cursor: pointer; border-bottom: 1px rgba(120, 120, 120, 0.2) solid;" class="p pl+" ng-click="setSql(sql)"><pre class="p0 m0" style="max-height: 48px; line-height: 16px; overflow: hidden; text-overflow: ellipsis">{{::sql}}</pre></div><small class="p+" ng-if="vars.sqlLog.length === 0">{{\'История запросов пуста\' | translate}}</small></md-sidenav>'),e.put("app/table/table-container.html",'<div style="position: absolute;top: 0px;bottom: 59px;left: 16px;right: 16px;"><h3>{{vars.currentDatabase}} <i class="mdi mdi-chevron-right"></i> {{vars.currentTable}}</h3><md-tabs md-dynamic1-height="" md-border-bottom="" class="h100"><md-tab><md-tab-label><i class="mdi mdi-table-column-plus-after mr-"></i>{{\'Структура\' | translate}}</md-tab-label><md-tab-body><table class="data-table"><thead><tr class="text-left"><th style="width: 40px"></th><th style="width: 40%">{{\'Название\' | translate}}</th><th style="width: 10%">{{\'Тип\' | translate}}</th><th style="width: 10%">{{\'Default тип\' | translate}}</th><th style="width: 10%">{{\'Значение\' | translate}}</th></tr></thead><tbody><tr class="text-left" ng-repeat="field in vars.columns.data"><td class="tc-grey-400">{{$index + 1}}</td><td ng-repeat="key in [\'name\', \'type\', \'default_type\', \'default_expression\'] track by $index">{{field[key]}}</td></tr></tbody></table></md-tab-body></md-tab><md-tab><md-tab-label><i class="mdi mdi-table-large mr-"></i>{{\'Данные\' | translate}}</md-tab-label><md-tab-body><div class="pl+ pt+ pb+ pr" style="font-size: .75rem;max-height:100%"><div class="float-right" style="margin-top: -12px"><md-button class="md-icon-button" aria-label="load prev" ng-click="loadPrev()" ng-disabled="vars.offset === 0"><i class="mdi mdi-arrow-left"></i></md-button><md-button class="md-icon-button" aria-label="load next" ng-click="loadNext()"><i class="mdi mdi-arrow-right"></i></md-button></div>{{\'Данные\' | translate}} <span class="tc-grey-400">{{\'с\' | translate}} {{vars.offset}} {{\'по\' | translate}} {{vars.offset + vars.limit}}</span></div><div class="card__actions p+" style="position:absolute; top:46px; bottom:0;left:0;right:0; overflow:hidden;" ng-scrollbars="" ng-scrollbars-config="vars.scrollConfig"><span ng-if="vars.data === null&&!vars.loading" class="fs-caption">{{\'нет данных\' | translate}}</span><md-progress-circular ng-if="vars.loading" class="md-accent" md-diameter="40"></md-progress-circular><div ng-if="vars.data !== null && vars.data != -1" ng-bind-html="vars.data"></div></div></md-tab-body></md-tab><md-tab><md-tab-label><i class="mdi mdi-information mr-"></i>{{\'Информация\' | translate}}</md-tab-label><md-tab-body><div class="data-table-container"><table class="data-table"><tbody><tr class="data-table-row"><td class="tc-grey-400" style="width: 40px">1</td><td style="width: 200px">{{\'Размер\' | translate}}</td><td>{{vars.statistics.size}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">2</td><td>{{\'Размер, байт\' | translate}}</td><td>{{vars.statistics.sizeBytes}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">3</td><td>{{\'Первая запись\' | translate}}</td><td>{{vars.statistics.minDate}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">4</td><td>{{\'Последняя запись\' | translate}}</td><td>{{vars.statistics.maxDate}}</td></tr></tbody></table></div></md-tab-body></md-tab></md-tabs></div>'),e.put("app/table/table.html",'<div ng-controller="TableContainerController" ng-include="\'app/table/table-container.html\'" ng-init="initOnGo()"></div>')}]),function(e,t){function a(e,t){var a=t.dbName,n=t.tableName;e.vars={dbName:a,tableName:n}}e.module(t.app.name).controller("TableController",a),a.$inject=["$scope","$stateParams"]}(angular,smi2),function(e,t){function a(e,t,a,n,r,i,s){e.vars={columns:{},data:null,grid:null,limit:100,offset:0,statistics:{},loading:!1,scrollConfig:{autoHideScrollbar:!1,theme:n.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}},e.initContainer=function(){t.$watch("currentTable",function(a){a&&(e.vars.currentTable=t.currentTable,e.vars.currentDatabase=t.currentDatabase,e.init())})},e.initOnGo=function(){e.$parent.vars&&(s.get("tableSiedenav")&&i("tableSiedenav").close(),e.vars.currentTable=e.$parent.vars.tableName,e.vars.currentDatabase=e.$parent.vars.dbName,e.init())},e.load=function(){e.vars.data=-1,a.query("\n                select *\n                from "+e.vars.currentDatabase+"."+e.vars.currentTable+"\n                limit "+e.vars.offset+", "+e.vars.limit+"\n                ").then(function(t){e.vars.data=a.dataToHtml(t),e.vars.loading=!1},function(t){e.vars.loading=!1,console.error("Ошибка "+t)})},e.init=function(){e.vars.loading=!0,a.query("describe table "+e.vars.currentDatabase+"."+e.vars.currentTable).then(function(t){return e.vars.columns=t}),a.query("SELECT 	table, 	formatReadableSize(sum(bytes)) as size, 	sum(bytes) as sizeBytes, 	min(min_date) as minDate, 	max(max_date) as maxDate FROM  	system.parts WHERE 	database = '"+e.vars.currentDatabase+"' AND 	( 		table = '"+e.vars.currentTable+"' OR 		table = '"+e.vars.currentTable+"_sharded'    ) GROUP BY     table ").then(function(t){return e.vars.statistics=t&&t.data.length&&t.data[0]||{}}),e.load()},e.loadNext=function(){e.vars.offset+=e.vars.limit,e.load()},e.loadPrev=function(){e.vars.offset>0&&(e.vars.offset-=e.vars.limit,e.load())}}e.module(t.app.name).controller("TableContainerController",a),a.$inject=["$scope","$rootScope","API","ThemeService","$stateParams","$mdSidenav","$mdComponentRegistry"]}(angular,smi2),window.global_keywords_fields="",window.global_keywords_tables="",function(e,t){function a(t,a,n,r,i,s,o,l,d,m,c){var u="sqlHistory2",b="sqlLog",p="saveTabs",g="sessionData",v=30;t.vars={sqlHistory:r.get(u)||[],dictionaries:[],tabs:[],saveTabs:r.get(p)||!1,uiTheme:d.themeObject,uiThemes:d.list,currentTab:{},selectedTab:0,sqlLog:r.get(b)||[],formats:[{name:c("translate")("Таблица"),sql:" format JSON",render:"html"},{name:"JSON compact",sql:" format JSONCompact"}],db:null,limitRows:r.get("editorLimitRows")||500,fontSize:r.get("editorFontSize")||16,theme:r.get("editorTheme")||"cobalt"},t.vars.format=t.vars.formats[0],t.vars.themes=["ambiance","eclipse","mono_industrial","tomorrow_night_blue","chaos","github","monokai","tomorrow_night_bright","chrome","idle_fingers","pastel_on_dark","tomorrow_night_eighties","clouds","iplastic","solarized_dark","tomorrow_night","clouds_midnight","katzenmilch","solarized_light","twilight","cobalt","kr_theme","sqlserver","vibrant_ink","crimson_editor","kuroir","terminal","xcode","dawn","merbivore","textmate","dreamweaver","merbivore_soft","tomorrow"],a.breadcrumbs=[{text:"SQL",link:"sql"}],n.onbeforeunload=function(e){if(""!==t.vars.currentTab.sql&&"localhost"!=location.hostname){var a=c("translate")("Хотите покинуть страницу?");return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}};var h=t.$on("$stateChangeStart",function(e){var a=c("translate")("Хотите покинуть страницу?");e.defaultPrevented||""===t.vars.currentTab||confirm(a)||e.preventDefault()}),f=function(){if(t.vars.saveTabs){var e=t.vars.tabs.map(function(e){return{name:e.name,sql:e.sql,buttonTitle:e.buttonTitle,format:e.format,results:[],editor:null,selectedResultTab:0}});r.set(g,e)}};t.executeQuery=function(a,n,r){var s="";t.vars.currentTab.loading=!0,t.vars.limitRows&&(s+="max_result_rows="+t.vars.limitRows+"&result_overflow_mode=throw"),i.query(a.sql,a.format,!0,s).then(function(e){var i=e;"object"!==("undefined"==typeof e?"undefined":_typeof(e))&&(e={data:i,meta:null,rows:null,statistics:null}),e.error=!1,e.query=a;var s=t.renderResult(e);r.data.push(s),a.index+1<n.length?t.executeQuery(n[a.index+1],n,r):t.renderFinalResult(r)},function(n){l.show(l.simple().content(c("translate")("Ошибка")).theme(d.theme).position("bottom right"));var i={meta:null,rows:null,query:a,statistics:null};n&&n.data?i.error=e.toJson(n.data).replace(/\\n/gi,"<br/>").replace(/^"/,"").replace(/"$/,""):i.error=n,r.data.push(t.renderResult(i)),t.renderFinalResult(r)})},t.renderResult=function(t){return"string"==typeof t.error?t.result='<pre class="fs-caption tc-red-700">'+t.error+"</pre>":"object"!==_typeof(t.data)?"string"!=typeof t.data?t.result='<pre class="fs-caption">'+e.toJson(t.data,!0)+"</pre>":t.result='<pre class="fs-caption">'+t.data+"</pre>":(t.result=i.dataToHtml(t),t.createtable=i.dataToCreateTable(t)),t},t.renderFinalResult=function(e){t.vars.currentTab.loading=!1,e.data.find(function(e){return e.query&&e.query.keyword&&-1!=["DROP","CREATE","ALTER"].indexOf(e.query.keyword.toUpperCase())})&&t.selectDatabase(t.vars.db)},t.execute=function(a,n){var i=n.sql,s=0,o=n.editor,m=[],u=o.getSelectedText(),p={data:[],time:c("date")(new Date,"HH:mm:ss"),pinned:!1};return""!==u&&null!==u&&(i=u),""===i||null===i?void l.show(l.simple().content(c("translate")("Не введен SQL")).theme(d.theme).position("bottom right")):(n.results=n.results.reduce(function(e,t){return t.pinned&&e.push(t),e},[]),n.results.unshift(p),-1==t.vars.sqlLog.indexOf(i)&&(t.vars.sqlLog.unshift(i),t.vars.sqlLog.length>v&&t.vars.sqlLog.splice(0,v),r.set(b,t.vars.sqlLog)),f(),o.session.$mode.splitByTokens(i,"constant.character.escape",";;").forEach(function(t){var n=t.sql;if(!(n.length<5)){if("current"==a&&!u){var r=o.selection.getCursor();if(!r||!e.isDefined(r)||0!==t.range.compare(r.row,r.column))return}var i=null,l=!1,d=!1,c=null,b=o.session.$mode.findTokens(n,"storage",!0),p=o.session.$mode.findTokens(n,"keyword",!0);b.hasOwnProperty("value")?(i=!1,d=b.value):(i=" FORMAT JSON ",l=!0),p.hasOwnProperty("value")&&(c=p.value),"select"!==c&&(i=!1,l=!1),m.push({sql:n,index:s,format:i,setedformat:l,keyword:c,storage:d}),s++}}),void(m.length&&t.executeQuery(m[0],m,p)))},t.setTheme=function(e){t.vars.theme=e,t.vars.tabs.forEach(function(t){return t.editor.setTheme("ace/theme/"+e)}),r.set("editorTheme",e)},t.selectDatabase=function(e){e&&(t.vars.db=e,i.setDatabase(e),i.query("SELECT table,name,type FROM system.columns WHERE database='"+e+"'",null).then(function(a){var n=[],r={},i=[],s={},o=[];a.meta.forEach(function(e){o.push(e.name)}),a.data.forEach(function(e){o.forEach(function(t){"table"==t&&(s.hasOwnProperty(e[t])||(s[e[t]]=1,i.push(e[t]))),"name"==t&&(r.hasOwnProperty(e[t])||(r[e[t]]=1,n.push(e[t])))})}),window.global_keywords_fields=n.join("|")+"|",window.global_keywords_tables=i.join("|")+"|"+e,t.vars.tabs.forEach(function(e){e.editor&&(e.editor.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.editor.session.bgTokenizer.start(0))})}))},t.addDictionariesWord=function(e){var a=t.vars.currentTab.editor,n=a.getCursorPosition();n.column+=e.length,a.clearSelection(),a.insert(e),t.vars.currentTab.sql=a.getValue(),m(function(){a.focus(),a.moveCursorToPosition(n)})},t.loadDictionaries=function(){t.vars.dictionaries=[],i.query("select name,key,attribute.names,attribute.types from system.dictionaries ARRAY JOIN attribute ORDER BY name,attribute.names",null).then(function(e){e.data.forEach(function(e){var a="dictGet"+e["attribute.types"]+"('"+e.name+"','"+e["attribute.names"]+"',to"+e.key+"( ID ) ) AS "+e.name.replace(/\./,"_")+"_"+e["attribute.names"]+",";t.vars.dictionaries.push({dic:a,title:e.name+"."+e["attribute.names"]+" as "+e["attribute.types"]})})})},t.aceLoaded=function(e){var a=t.vars.tabs.find(function(e){return!e.editor})||t.vars.currentTab;a.editor=e,e.$blockScrolling=1/0,e.setOptions({fontSize:t.vars.fontSize+"px",enableBasicAutocompletion:!0,enableSnippet:!0,enableLiveAutocompletion:!1}),e.setTheme("ace/theme/"+t.vars.theme),e.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.session.bgTokenizer.start(0),e.commands.addCommand({name:"runCurrentCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(){t.execute("current",a)}}),e.commands.addCommand({name:"runAllCommand",bindKey:{win:"Shift-Ctrl-Enter",mac:"Shift-Command-Enter"},exec:function(){t.execute("all",a)}}),e.clearSelection(),e.focus(),e.selection.moveTo(0,0),e.on("changeSelection",function(){m(function(){a.buttonTitle=""!==e.getSelectedText()?c("translate")("Выполнить выделенное ⌘ + ⏎"):c("translate")("Выполнить все ⇧ + ⌘ + ⏎"),a.originalSql&&(a.changed=a.originalSql!=a.sql)})}),t.loadDictionaries()},a.$watch("currentDatabase",t.selectDatabase),t.$watch("vars.limitRows",function(e){return r.set("editorLimitRows",e)}),t.$watch("vars.fontSize",function(e){e&&(t.vars.tabs.forEach(function(t){return t.editor&&t.editor.setOptions({fontSize:e+"px"})}),r.set("editorFontSize",e))}),t.save=function(e,a){return o.show(o.prompt().title(c("translate")("Сохранить SQL как")).placeholder(c("translate")("название")).initialValue(e.name).targetEvent(a).ok(c("translate")("Сохранить")).cancel(c("translate")("Отмена"))).then(function(a){var n=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=n?(t.vars.sqlHistory[n].sql=e.sql,t.vars.sqlHistory[n].name=a):t.vars.sqlHistory.push({sql:e.sql,name:a}),e.originalSql=e.sql,e.name=a,r.set(u,t.vars.sqlHistory),f()})},t.load=function(e){t.vars.currentTab.sql=e.sql,t.vars.currentTab.originalSql=e.sql,t.vars.currentTab.name=e.name},t.getExportData=function(t){return t.map(function(t){return Object.keys(t).map(function(a){return e.isArray(t[a])?t[a].join(", "):t[a]})})},t.getExportHeaders=function(e){return e.map(function(e){return e.name})},t.addTab=function(){t.vars.currentTab={name:"new SQL",sql:"",buttonTitle:c("translate")("Выполнить ⌘ + ⏎"),format:{},editor:null,results:[],selectedResultTab:0},t.vars.tabs.push(t.vars.currentTab),f()},t.removeTab=function(e,a){a.stopPropagation();var n=function(){t.vars.tabs.splice(t.vars.tabs.indexOf(e),1),t.vars.tabs.length==t.vars.selectedTab&&t.vars.selectedTab--};e.changed?o.show(o.confirm().title(c("translate")("SQL изменен. Сохранить перед закрытием?")).targetEvent(a).ok(c("translate")("Да")).cancel(c("translate")("Нет"))).then(function(){var a=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=a&&(t.vars.sqlHistory[a].sql=e.sql,t.vars.sqlHistory[a].name=e.name),r.set(u,t.vars.sqlHistory),n()},n):n()},t.removeResult=function(e,t,a){a.stopPropagation(),e.results.splice(e.results.indexOf(t),1)},t.toggleSidenav=function(e){s(e).toggle()},t.removeHistory=function(e,a){a.preventDefault();var n=t.vars.sqlHistory.indexOf(e);-1!=n&&o.show(o.confirm().title("Удалить "+e.name+"?").targetEvent(a).ok("Да").cancel("Нет")).then(function(){t.vars.sqlHistory.splice(n,1),r.set(u,t.vars.sqlHistory)})},t.$watch("vars.saveTabs",function(e,t){r.set(p,e),t===!1&&e===!0&&f()}),t.setUiTheme=function(e){return d.set(e.name)},t.setSql=function(e){t.vars.currentTab.sql=e,t.toggleSidenav("log"),m(function(){return t.vars.currentTab.editor.focus()},500)},t.changeTabName=function(e,a){a.stopPropagation(),o.show(o.prompt().title(c("translate")("Название вкладки")).placeholder(c("translate")("название")).initialValue(e.name).targetEvent(a).ok(c("translate")("Применить")).cancel(c("translate")("Отмена"))).then(function(a){var n=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=n&&(e.originalSql=e.sql,t.vars.sqlHistory[n].name=a,r.set(u,t.vars.sqlHistory)),e.name=a,f()})},t.vars.saveTabs?(t.vars.tabs=r.get(g),t.vars.tabs.length>0?m(function(){return t.vars.currentTab=t.vars.tabs[0]},500):t.addTab()):(r.set(g,[]),t.addTab()),a.currentDatabase&&t.selectDatabase(a.currentDatabase),t.$on("$destroy",function(){i.setDatabase(a.currentDatabase),h(),n.onbeforeunload=null})}e.module(t.app.name).controller("SqlController",a),a.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService","$timeout","$filter"]}(angular,smi2);var define=window.define||window.ace.define;define("ace/mode/clickhouse_highlight_rules",["$rootScope","require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t){var a=e("../lib/oop"),n=e("./text_highlight_rules").TextHighlightRules,r=function(){var e="SELECT|INSERT|UPDATE|DELETE|FROM|WHERE|AND|OR|LIMIT|OFFSET|HAVING|AS|WHEN|ELSE|END|TYPE|LEFT|RIGHT|JOIN|ON|OUTER|DESC|ASC|UNION|CREATE|TABLE|PRIMARY|KEY|FOREIGN|NOT|REFERENCES|DEFAULT|NULL|INNER|CROSS|NATURAL|DATABASE|DROP|GRANT|ANY|ATTACH|DETACH|DESCRIBE|OPTIMIZE|PREWHERE|TOTALS|DATABASES|PROCESSLIST|SHOW|IF",t="IF\\W+NOT\\W+EXISTS|IF\\W+EXISTS|FORMAT\\W+Vertical|FORMAT\\W+JSONCompact|FORMAT\\W+JSONEachRow|FORMAT\\W+TSKV|FORMAT\\W+TabSeparatedWithNames|FORMAT\\W+TabSeparatedWithNamesAndTypes|FORMAT\\W+TabSeparatedRaw|FORMAT\\W+BlockTabSeparated|FORMAT\\W+CSVWithNames|FORMAT\\W+CSV|FORMAT\\W+JSON|FORMAT\\W+TabSeparated",a="true|false",n="avg|count|first|last|max|min|sum|ucase|lcase|mid|len|round|rank|now|coalesce|ifnull|isnull|nvl|countIf|timeSlot|yesterday|today|now|toRelativeSecondNum|toRelativeMinuteNum|toRelativeHourNum|toRelativeDayNum|toRelativeWeekNum|toRelativeMonthNum|toRelativeYearNum|toTime|toStartOfHour|toStartOfFiveMinute|toStartOfMinute|toStartOfYear|toStartOfQuarter|toStartOfMonth|toMonday|toSecond|toMinute|toHour|toDayOfWeek|toDayOfMonth|toMonth|toYear|toFixedString|toStringCutToZero|reinterpretAsString|reinterpretAsDate|reinterpretAsDateTime|reinterpretAsFloat32|reinterpretAsFloat64|reinterpretAsInt8|reinterpretAsInt16|reinterpretAsInt32|reinterpretAsInt64|reinterpretAsUInt8|reinterpretAsUInt16|reinterpretAsUInt32|reinterpretAsUInt64|toUInt8|toUInt16|toUInt32|toUInt64|toInt8|toInt16|toInt32|toInt64|toFloat32|toFloat64|toDate|toDateTime|toString|bitAnd|bitOr|bitXor|bitNot|bitShiftLeft|bitShiftRight|abs|negate|modulo|intDivOrZero|intDiv|divide|multiply|minus|plus|empty|notEmpty|length|lengthUTF8|lower|upper|lowerUTF8|upperUTF8|reverse|reverseUTF8|concat|substring|substringUTF8|appendTrailingCharIfAbsent|position|positionUTF8|match|extract|extractAll|like|notLike|replaceOne|replaceAll|replaceRegexpOne|range|arrayElement|has|indexOf|countEqual|arrayEnumerate|arrayEnumerateUniq|arrayJoin|arrayMap|arrayFilter|arrayExists|arrayCount|arrayAll|arrayFirst|arraySum|splitByChar|splitByString|alphaTokens|domainWithoutWWW|topLevelDomain|firstSignificantSubdomain|cutToFirstSignificantSubdomain|queryString|URLPathHierarchy|URLHierarchy|extractURLParameterNames|extractURLParameters|extractURLParameter|queryStringAndFragment|cutWWW|cutQueryString|cutFragment|cutQueryStringAndFragment|cutURLParameter|IPv4NumToString|IPv4StringToNum|IPv4NumToStringClassC|IPv6NumToString|IPv6StringToNum|rand|rand64|halfMD5|MD5|sipHash64|sipHash128|cityHash64|intHash32|intHash64|SHA1|SHA224|SHA256|URLHash|hex|unhex|bitmaskToList|bitmaskToArray|floor|ceil|round|roundToExp2|roundDuration|roundAge|regionToCountry|regionToContinent|regionToPopulation|regionIn|regionHierarchy|regionToName|OSToRoot|OSIn|OSHierarchy|SEToRoot|SEIn|SEHierarchy|dictGetUInt8|dictGetUInt16|dictGetUInt32|dictGetUInt64|dictGetInt8|dictGetInt16|dictGetInt32|dictGetInt64|dictGetFloat32|dictGetFloat64|dictGetDate|dictGetDateTime|dictGetString|dictGetHierarchy|dictHas|dictIsIn|uniq|argMin|argMax|uniqCombined|uniqHLL12|uniqExact|groupArray|groupUniqArray|quantile|quantileDeterministic|quantileTiming|quantileTimingWeighted|quantileExact|quantileExactWeighted|quantileTDigest|median|quantiles|varSamp|varPop|stddevSamp|stddevPop|covarSamp|covarPop|corr|sequenceMatch|sequenceCount|uniqUpTo|countIf|avgIf|quantilesTimingIf|argMinIf|uniqArray|sumArray|quantilesTimingArrayIf|uniqArrayIf|medianIf|quantilesIf|varSampIf|varPopIf|stddevSampIf|stddevPopIf|covarSampIf|covarPopIf|corrIf|uniqArrayIf|sumArrayIf",r="int|numeric|decimal|date|varchar|char|bigint|float|double|bit|binary|text|set|timestamp|money|real|number|integer|uint8|uint16|uint32|uint64|int8|int16|int32|int64|float32|float64|datetime|enum8|enum16|array|tuple|string",i=this.createKeywordMapper({
"support.function":n,keyword:e,"constant.language":a,"storage.type":r,"markup.bold":window.global_keywords_tables,"markup.heading":window.global_keywords_fields},"identifier",!0);this.$rules={start:[{token:"comment",regex:"--.*$",caseInsensitive:!0},{token:"keyword",regex:"GROUP\\W+BY|ORDER\\W+BY"},{token:"comment",start:"/\\*",end:"\\*/"},{token:"string",regex:'".*?"'},{token:"storage",regex:t},{token:"string",regex:"'.*?'"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:i,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"constant.character.escape",regex:/;{2}/},{token:"punctuation",regex:/[?:,;.]/},{token:"keyword.operator",regex:"\\+|\\-|\\/|\\/\\/|%|<@>|@>|<@|&|\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"text",regex:"\\s+"}]},this.normalizeRules();var s=[],o=function(e,t){e.forEach(function(e){s.push({name:e,value:e,score:0,meta:t})})};o(n.split("|"),"function"),o(e.split("|"),"keyword"),o("GROUP BY|ORDER BY|FORMAT JSON|FORMAT JSONCompact|FORMAT JSONEachRow|FORMAT TSKV|FORMAT TabSeparated|FORMAT TabSeparatedWithNames|FORMAT TabSeparatedWithNamesAndTypes|FORMAT TabSeparatedRaw|FORMAT BlockTabSeparated|FORMAT CSV|FORMAT CSVWithNames".split("|"),"keyword"),o(r.split("|"),"type"),o(window.global_keywords_tables.split("|"),"storage"),o(window.global_keywords_fields.split("|"),"storage"),this.completions=s};a.inherits(r,n),t.ClickhouseHighlightRules=r}),define("ace/mode/clickhouse",["require","exports","module","ace/lib/oop","ace/mode/text","ace/token_iterator","ace/mode/clickhouse_highlight_rules","ace/range"],function(e,t){var a=e("../lib/oop"),n=e("./text").Mode,r=e("./clickhouse_highlight_rules").ClickhouseHighlightRules,i=function(){this.HighlightRules=r};a.inherits(i,n),function(){this.lineCommentStart="--",this.getCompletions=function(e,t){return t.$mode.$highlightRules.completions},this.$id="ace/mode/clickhouse",this.findTokens=function(t,a,n){t=t.replace(/^(\r\n|\n|\r)/gm,"").replace(/(\r\n|\n|\r)$/gm,"");for(var r=e("ace/token_iterator").TokenIterator,i=e("ace/edit_session").EditSession,s=new i(t,this),o=new r(s,0,0),l=o.getCurrentToken(),d=[];l;){var m=l;if(m.row=o.getCurrentTokenRow(),m.col=o.getCurrentTokenColumn(),m.type==a&&(d.push(m),n))return m.value=m.value.toLowerCase(),m;l=o.stepForward()}return d},this.splitByTokens=function(t,a,n){t=t.replace(/^(\r\n|\n|\r)/gm,"").replace(/(\r\n|\n|\r)$/gm,"");for(var r=e("ace/token_iterator").TokenIterator,i=e("ace/edit_session").EditSession,s=e("ace/range").Range,o=new i(t,this),l=new r(o,0,0),d=l.getCurrentToken(),m=[],c=0,u=0;d;){var b=d;if(b.row=l.getCurrentTokenRow(),b.col=l.getCurrentTokenColumn(),b.type==a&&b.value==n){var p=new s(c,u,b.row,b.col+n.length),g=o.getTextRange(p);c=b.row,u=b.col+n.length,g=g.trim().replace(new RegExp("^"+n+"|"+n+"$","g"),"").trim().replace(/^(\r\n|\n|\r)/gm,"").replace(/(\r\n|\n|\r)$/gm,""),g.length>2&&m.push({sql:g,range:p})}d=l.stepForward()}var p=new s(c,u,Number.MAX_VALUE,Number.MAX_VALUE),g=o.getTextRange(p);return g=g.trim().replace("^("+n+")","").replace(n+"$","").trim().replace(/^(\r\n|\n|\r)/gm,"").replace(/(\r\n|\n|\r)$/gm,""),g=g.replace(new RegExp("^"+n+"|"+n+"$","g"),"").trim().replace(/^(\r\n|\n|\r)/gm,"").replace(/(\r\n|\n|\r)$/gm,""),g.length>2&&m.push({sql:g,range:p}),m}}.call(i.prototype),t.Mode=i}),function(e,t){function a(e,t){var a=e.get("themeName")||"dark",n=[{isDark:!1,name:"default",title:t("translate")("Светлая тема")},{isDark:!0,name:"dark",title:t("translate")("Темная тема")}],r=n.find(function(e){return e.name==a})||n[0];return{isDark:function(){return r.isDark},theme:r.name,themeObject:r,set:function(t){t!=a&&(e.set("themeName",t),location.href=location.href)},list:n}}e.module(t.app.name).service("ThemeService",a),a.$inject=["localStorageService","$filter"]}(angular,smi2),function(e,t){function a(e,t){return{responseError:function(a){return 401==a.status&&t.get("$state").go("login"),e.reject(a)}}}e.module(t.app.name).service("HttpInterceptor",a),a.$inject=["$q","$injector"]}(angular,smi2),function(e,t){function a(t,a,n,r,i){var s="currentBaseConfig",o=8123,l=null,d={},m=n.get(s);m&&m.host&&(d=m),this.setConnection=function(t){n.set(s,t),d=e.copy(t),/.*\:\d+$/.test(d.host)||(d.host+=":"+o)},this.clear=function(){l=null,d={},n.set(s,{})},this.query=function(n,r,i,s){var o=a.defer(),m="";r!==!1?(r=r||" FoRmAt JSON","null"==r&&(r=""),m=n+" "+r):m=n;var c="";d.host.indexOf("://")>0||0==d.host.indexOf("/")||(c="http://");var u=c+d.host+"/?query="+encodeURIComponent(m);d.login&&(u+="&user="+d.login),d.password&&(u+="&password="+d.password),0!=d.host.indexOf("/")&&(u+="&add_http_cors_header=1"),i&&(u+="&database="+l),s&&(u+="&"+s);var b={method:r?"GET":"POST",url:u,transformResponse:function(t,a,n){try{return e.fromJson(t)}catch(r){return t?t:"\nStatus:"+n+"\nHeaders:"+e.toJson(a())}}};return t(b).then(function(e){o.resolve(e.data)},function(e){o.reject(e.data)}),o.promise},this.getConnectionInfo=function(){return d},this.setDatabase=function(e){return l=e},this.getDatabase=function(){return l},this.dataToCreateTable=function(e){var t="\nCREATE TABLE x (\n",a=[];return e.meta.forEach(function(e){return a.push("	"+e.name+" "+e.type)}),t+a.join(",\n")+"\n ) ENGINE = Log \n;;\n"},this.dataToHtml=function(e){var t='<table class="sql-table '+i.theme+'"><tr>',a=[];return e.meta.forEach(function(e){t+="<th>"+r(e.name)+'\n                            <div class="sql-table__subheader">'+r(e.type)+"</div>\n                        </th>",a.push(e.name)}),e.data.forEach(function(e){t+="<tr>",a.forEach(function(a){t+="<td>"+r(e[a])+"</td>"}),t+="</tr>"}),t+="</table>"},this.dataToUIGrid=function(e){var t=[];return e.meta.forEach(function(e){t.push({field:e.name,minWidth:100,enableColumnResizing:!0,headerTooltip:e.type})}),{enableSorting:!0,enableFiltering:!0,enableColumnResizing:!0,columnDefs:t,enableGridMenu:!0,enableSelectAll:!0,showGridFooter:!0,showColumnFooter:!0,data:e.data}}}e.module(t.app.name).service("API",a),a.$inject=["$http","$q","localStorageService","$sanitize","ThemeService"]}(angular,smi2),function(e,t){function a(e,a,n,r,i,s){var o="basesConfig";e.vars={bases:n.get(o)||[],db:{},loading:!1,version:t.app.version,themes:s.list},e.login=function(){if(e.vars.loading=!0,e.vars.db.id){for(var t=0;t<e.vars.bases.length;t++)if(e.vars.bases[t].id==e.vars.db.id){e.vars.bases[t]=e.vars.db;break}}else e.vars.db.id=(new Date).getTime(),e.vars.bases.push(e.vars.db);n.set(o,e.vars.bases),r.setConnection(e.vars.db),r.query("SELECT 'login success'").then(function(){return a.go("sql")},function(){e.vars.loading=!1,i.show(i.simple().content("Ошибка доступа").theme(s.theme).position("bottom right"))})},e.remove=function(){var t=e.vars.bases.findIndex(function(t){return t.id==e.vars.db.id});e.vars.bases.splice(t),n.set(o,e.vars.bases),e.vars.db={}},e.setUiTheme=function(e){return s.set(e.name)}}e.module(t.app.name).controller("LoginController",a),a.$inject=["$scope","$state","localStorageService","API","$mdToast","ThemeService"]}(angular,smi2),function(e,t){e.module(t.app.name).filter("filesize",function(){var e=["bytes","KB","MB","GB","TB","PB"];return function(t,a){if(isNaN(parseFloat(t))||!isFinite(t))return"?";for(var n=0;t>=1024;)t/=1024,n++;return t.toFixed(+a)+" "+e[n]}})}(angular,smi2),function(e,t){function a(e,t,a,n,r,i){e.vars={loaded:!1,databases:[]},e.vars.scrollConfig={autoHideScrollbar:!1,theme:r.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:400,advanced:{updateOnContentResize:!0}},e.vars.metis={config:{toggle:!0,preventDefault:!1}},e.clickAndSelect=function(a,n){return a.name==t.currentDatabase?(n.stopPropagation(),!1):void e.selectDatabase(a)},e.selectDatabase=function(e){t.currentDatabase=e.name,i("tableSiedenav").close()},e.openTable=function(e){i("tableSiedenav").close(),t.currentTable=e.name,i("tableSiedenav").open()},n.query("SELECT 	database, 	name FROM  	system.tables").then(function(t){var a=t.data||[];e.vars.databases=a.reduce(function(e,t){var a=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var o=i.value;if(o.name==t.database)return o.tables.push({name:t.name}),e}}catch(l){n=!0,r=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(n)throw r}}return[].concat(_toConsumableArray(e),[{name:t.database,tables:[{name:t.name}]}])},[]),e.selectDatabase(e.vars.databases[0]),e.vars.loaded=!0})}e.module(t.app.name).controller("SidebarController",a),a.$inject=["$scope","$rootScope","$state","API","ThemeService","$mdSidenav"]}(angular,smi2),function(e,t){function a(e,t,a,n){e.user=a.getConnectionInfo().name,e.themes=n.list,e.logout=function(){a.clear(),t.go("login")},e.setUiTheme=function(e){return n.set(e.name)}}e.module(t.app.name).controller("HeaderController",a),a.$inject=["$scope","$state","API","ThemeService"]}(angular,smi2),function(){angular.module(smi2.app.name).run(["$rootScope","$state",function(e,t){e.breadcrumbs=[],e.currentDatabase=null;var a=e.$on("$stateChangeError",function(e,a,n,r,i,s){"notAuthorized"==s&&t.go("login")});e.$on("$destroy",function(){return a})}])}(),function(e,t){e.module(t.app.name).config(["$stateProvider",function(t){t.state("base",{"abstract":!0,resolve:{session:["$q","API",function(t,a){var n=t.defer();return e.isDefined(a.getConnectionInfo().host)?n.resolve():n.reject("notAuthorized"),n.promise}]},templateUrl:"app/base/base.html"}).state("layout",{parent:"base","abstract":!0,views:{header:{templateUrl:"app/base/header.html",controller:"HeaderController"},sidebar:{templateUrl:"app/base/sidebar.html",controller:"SidebarController"},main:{template:"<ui-view/>"}}}).state("dashboard",{parent:"layout",url:"/",controller:["$state",function(e){return e.go("sql")}]}).state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginController"}).state("sql",{parent:"layout",url:"/sql",templateUrl:"app/sql/sql.html",controller:"SqlController"}).state("table",{parent:"layout",url:"/database/{dbName}/table/{tableName}",templateUrl:"app/table/table.html",controller:"TableController"}).state("404",{parent:"layout",templateUrl:"app/base/404.html"})}])}(angular,smi2),function(e,t){e.module(t.app.name).config(["$locationProvider","$httpProvider","$sceProvider","$urlRouterProvider","$mdThemingProvider","ThemeServiceProvider",function(e,t,a,n,r,i){e.html5Mode(!0).hashPrefix("!"),t.interceptors.push("HttpInterceptor"),a.enabled(!1),n.otherwise(function(e){var t=e.get("$state");t.transitionTo("404")}),i.$get().isDark()&&r.theme("default").dark().primaryPalette("blue").accentPalette("blue",{"default":"500"})}]).config(["$translateProvider",function(e){e.translations("en",{"Подключение":"Connection","Неверные данные":"some data is wrong","Название":"name","Хост:порт":"host:port","Логин":"login","Пароль":"password","Удалить":"Delete","Войти":"Sign in","не найдено":"not found","нет данных":"no data","Назад":"Back","Выход":"Sing out","Шрифт":"font","История запросов пуста":"Requests's history is empty","Структура":"Structure","Данные":"Data","Информация":"Information","Размер":"Size","Размер, байт":"Size in bytes","Первая запись":"First record","Последняя запись":"Last record","Тип":"Type","Default тип":"Default type","Значение":"Default value","Рабочий стол":"Dashboard","База":"Database","Выполнить ⌘ + ⏎":"Run ⌘ + ⏎","Таблица":"Table","Таблица ":"Table ","Хотите покинуть страницу?":"Do you want to leave this page?","Ошибка":"Error","Не введен SQL":"SQL request is empty","Выполнить выделенное ⌘ + ⏎":"Run selected ⌘ + ⏎","Выполнить все ⇧ + ⌘ + ⏎":"Run all ⇧ + ⌘ + ⏎","Просмотр":"Preview","Ошибка ":"Error ","Сохранить":"Save","Лог запросов":"Request's log","Тема интерфейса":"Theme","Тема":"Theme","Максимум строк":"Maximum lines","Настройки редактора":"Editor settings","Закрыть":"Close","Размер шрифта":"Font size","Формат результатов":"Result's format","Тема редактора":"Editor theme","Сохранять сессию":"Save session","На весь экран":"Full screen","Словари":"Dictionaries","CSV с заголовком":"CSV with headers","CSV без заголовка":"CSV without headers","Табулированный текст с заголовками":"Tabulated text with headers","Табулированный текст без заголовков":"Tabulated text without headers","время":"time","строк прочитано":"lines read","прочитано":"read","SQL изменен. Сохранить перед закрытием?":"SQL was changed. Save it before exit?","Да":"Yes","Нет":"No","Светлая тема":"Light theme","Темная тема":"Dark theme","с":"from","по":"to","Открыть таблицу":"Open table"}).translations("ru",{}).registerAvailableLanguageKeys(["en","ru"],{"ru_*":"ru","ru-*":"ru","*":"en"}).determinePreferredLanguage()}])}(angular,smi2);